[tox]
envlist = all
skipsdist = True

[testenv]
setenv =
   VIRTUAL_ENV={envdir}
deps = -r{toxinidir}/requirements.txt
whitelist_externals = sh
sitepackages=True
envdir={toxworkdir}/kubic-testinfra
passenv=ENVIRONMENT_JSON

[testenv:admin]
commands = 
    sh {toxinidir}/tools/testAllRoles.sh admin {env:ENVIRONMENT_JSON:{toxinidir}/../caasp-kvm/environment.json} {env:SSH_CONFIG:{toxinidir}/../misc-tools/environment.ssh_config} {posargs}

[testenv:master]
commands = 
    sh {toxinidir}/tools/testAllRoles.sh master {env:ENVIRONMENT_JSON:{toxinidir}/../caasp-kvm/environment.json} {env:SSH_CONFIG:{toxinidir}/../misc-tools/environment.ssh_config} {posargs}

[testenv:worker]
commands = 
    sh {toxinidir}/tools/testAllRoles.sh worker {env:ENVIRONMENT_JSON:{toxinidir}/../caasp-kvm/environment.json} {env:SSH_CONFIG:{toxinidir}/../misc-tools/environment.ssh_config} {posargs}

[testenv:all]
commands = 
    sh {toxinidir}/tools/testAllRoles.sh all {env:ENVIRONMENT_JSON:{toxinidir}/../caasp-kvm/environment.json} {env:SSH_CONFIG:{toxinidir}/../misc-tools/environment.ssh_config} {posargs}

[testenv:linters]
deps = -r{toxinidir}/test-requirements.txt
commands = sh tools/pretty_flake8.sh
envdir={toxworkdir}/linters

[flake8]
ignore = D203
exclude =
    .git,
    __pycache__,
    build,
    .venv,
    .tox
